<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>GCP Installation - Open Integration Hub</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>GCP Installation | Open Integration Hub</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="GCP Installation" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Open Source Integration Framework" /> <meta property="og:description" content="Open Source Integration Framework" /> <link rel="canonical" href="http://localhost:4000/docs/Getting%20Started/GCPInstallationGuide.html" /> <meta property="og:url" content="http://localhost:4000/docs/Getting%20Started/GCPInstallationGuide.html" /> <meta property="og:site_name" content="Open Integration Hub" /> <script type="application/ld+json"> {"headline":"GCP Installation","description":"Open Source Integration Framework","@type":"WebPage","url":"http://localhost:4000/docs/Getting%20Started/GCPInstallationGuide.html","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Open Integration Hub </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Getting%20Started/GettingStarted.html" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/Getting%20Started/LocalInstallationGuide.html" class="nav-list-link">Local Installation</a></li><li class="nav-list-item active"><a href="http://localhost:4000/docs/Getting%20Started/GCPInstallationGuide.html" class="nav-list-link active">GCP Installation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Services/Services.html" class="nav-list-link">Services</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/AttachmentStorageService.html" class="nav-list-link">Attachment Storage Service</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/AuditLog.html" class="nav-list-link">Audit Log</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/ComponentOrchestrator.html" class="nav-list-link">Component Orchestrator</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/ComponentRepository.html" class="nav-list-link">Component Repository</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/ConflictManagement.html" class="nav-list-link">Conflict Management</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/DataHub.html" class="nav-list-link">Data Hub</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/DispatcherService.html" class="nav-list-link">Dispatcher Service</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/FlowRepository.html" class="nav-list-link">Flow Repository</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/IdentityManagement.html" class="nav-list-link">Identity and Access Management</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/IntegrationLayerService.html" class="nav-list-link">Integration Layer Service</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/LoggingService.html" class="nav-list-link">Logging Service</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/MessageOrientedMiddleware.html" class="nav-list-link">Message Oriented Middleware</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/MetaDataRepository.html" class="nav-list-link">Meta Data Repository</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/Scheduler.html" class="nav-list-link">Scheduler</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/SecretService.html" class="nav-list-link">Secret Service</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/SnapshotsService.html" class="nav-list-link">Snapshots Service</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Services/Webhooks.html" class="nav-list-link">Webhooks</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Service%20Collaboration/ServiceCollaborationOverview.html" class="nav-list-link">Service Collaboration</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/Service%20Collaboration/serviceEvents.html" class="nav-list-link">Service Events</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Service%20Collaboration/updatePropagation.html" class="nav-list-link">Update Propagation</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/docs/API%20Reference/APIReferenceOverview.html" class="nav-list-link">API Reference Documentation</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Connectors/ConnectorBasics.html" class="nav-list-link">Connectors</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/Connectors/building-nodejs-component.html" class="nav-list-link">Development Example for Node.js</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Connectors/ActionsAndTriggers.html" class="nav-list-link">Actions and Triggers</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/docs/Connectors/StandardizedActionsAndTriggers.html" class="nav-list-link">Standardized Examples</a> </li></ul></li><li class="nav-list-item "><a href="http://localhost:4000/docs/Connectors/Transformer.html" class="nav-list-link">Transformer</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Data%20Models/DataModelBasics.html" class="nav-list-link">Master Data Models</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Data%20Models/Addresses/Address%20Model.html" class="nav-list-link">Addresses</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Data%20Models/Collaboration/Collaboration%20Model.html" class="nav-list-link">Collaboration</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Data%20Models/Documents/Document%20Model.html" class="nav-list-link">Documents</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Data%20Models/Products/Products%20Model.html" class="nav-list-link">Products</a><ul class="nav-list"></ul></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/docs/Contributing/ContributionGuidelines.html" class="nav-list-link">Contribution Guidelines</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Open Integration Hub" aria-label="Search Open Integration Hub" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/openintegrationhub" class="site-button" > Open Integration Hub on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/Getting%20Started/GettingStarted.html">Getting Started</a></li> <li class="breadcrumb-nav-list-item"><span>GCP Installation</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p align="center"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/large-oih-vertikal-zentriert.png" alt="Open Integration Hub" width="300" /> </p> <p><br /> <br /></p> <h1 id="google-cloud-platform-deployment-guide"> <a href="#google-cloud-platform-deployment-guide" aria-labelledby="google-cloud-platform-deployment-guide" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Google Cloud Platform Deployment Guide </h1> <p>The following guide helps to deploy the Open Integration Hub on the Google Cloud Platform.</p> <ul> <li><a href="#installation">Installation</a> <ul> <li><a href="#install-kubectl">Install Kubectl</a></li> <li><a href="#access-to-gcp-k8s">Access to GCP K8s</a></li> <li><a href="#basic-open-integration-hub-infrastructure-setup">Basic Open Integration Hub Infrastructure Setup</a></li> <li><a href="#setup-storage">Setup Storage</a></li> <li><a href="#identity-and-access-management-deployment">Identity and Access Management Deployment</a></li> <li><a href="#service-account-creation">Service Account Creation</a> <ul> <li><a href="#receive-user-token">Receive User Token</a></li> <li><a href="#login-as-admin">Login as Admin</a></li> <li><a href="#create-a-service-account">Create a Service Account</a></li> <li><a href="#create-persistent-service-token">Create persistent Service Token</a></li> <li><a href="#secret-creation">Secret Creation</a></li> </ul> </li> <li><a href="#service-availability">Service Availability</a></li> </ul> </li> <li><a href="#user-tutorial">User Tutorial</a> <ul> <li><a href="#creating-components">Creating Components</a></li> <li><a href="#creating-flows">Creating Flows</a></li> <li><a href="#starting-flows">Starting Flows</a></li> <li><a href="#lessons-learned">Lessons Learned</a></li> </ul> </li> </ul> <h1 id="installation"> <a href="#installation" aria-labelledby="installation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation </h1> <h2 id="install-kubectl"> <a href="#install-kubectl" aria-labelledby="install-kubectl" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Install Kubectl </h2> <p>Make sure you have kubectl installed locally. Official guide: <a href="https://kubernetes.io/de/docs/tasks/tools/install-kubectl/">Install Kubectl</a></p> <h2 id="access-to-gcp-k8s"> <a href="#access-to-gcp-k8s" aria-labelledby="access-to-gcp-k8s" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Access to GCP K8s </h2> <p>Make sure you have created a project on gcp and receive the authentication information for your cluster:</p> <ol> <li>Create project</li> <li>In case no cluster exists: Create one</li> <li>Get authentication information for the cluster</li> </ol> <p>For detailed information see: <a href="https://cloud.google.com/kubernetes-engine/docs/quickstart">Kubernetes Engine - Quickstart</a></p> <h2 id="basic-open-integration-hub-infrastructure-setup"> <a href="#basic-open-integration-hub-infrastructure-setup" aria-labelledby="basic-open-integration-hub-infrastructure-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Open Integration Hub Infrastructure Setup </h2> <p><strong>Please make sure to clone the <a href="https://github.com/openintegrationhub/openintegrationhub">monorepo</a> before you start. You will need the files in the minikube folder.</strong></p> <p>Set up the basic Open Integration Hub infrastructure. If you want to change you namespace in the <code class="language-plaintext highlighter-rouge">namespace.yaml</code>, you also need to adjust the namespace in each service.yaml and deployment.yaml.</p> <p>Before your apply ingress also make sure to replace host entries:</p> <p>E.g for <a href="https://github.com/openintegrationhub/openintegrationhub/blob/master/platform/ingress.yaml#L11">iam</a>:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">host</span><span class="pi">:</span> <span class="s">iam.openintegrationhub.com</span>
</code></pre></div></div> <p>After you changed the host entries execute the following commands:</p> <ol> <li><code class="language-plaintext highlighter-rouge">kubectl apply -f platform/namespace.yaml</code></li> <li><code class="language-plaintext highlighter-rouge">kubectl apply -f platform/rabbitmq.yaml</code></li> <li><code class="language-plaintext highlighter-rouge">kubectl apply -f platform/redis.yaml</code></li> <li><code class="language-plaintext highlighter-rouge">kubectl apply -f platform/ingress.yaml</code></li> </ol> <h2 id="setup-storage"> <a href="#setup-storage" aria-labelledby="setup-storage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setup Storage </h2> <p>Next, you need to make sure to setup / connect to a storage solution such as <a href="https://www.mongodb.com/cloud/atlas">MongoDB Atlas</a>. Optionally, the mongodb.yaml provided under <code class="language-plaintext highlighter-rouge">platform/mongodb.yaml</code> could be used. To do so:</p> <ul> <li>apply minikube/1-Platform/volume.yaml</li> <li>apply minikube/1-Platform/volumeClaim.yaml</li> <li>apply minikube/1-Platform/platform/mongodb.yaml</li> </ul> <p>Note: <em>We suggest to use the first variant i.e. an external storage solution</em></p> <p>Irrespective of the solution you choose, ensure that each service uses its own database. This is necessary to ensure proper encapsulation and to avoid accidental data pollution. For more information about MongoDB databases, please refer to the official <a href="https://docs.mongodb.com/manual/core/databases-and-collections/">MongoDB Documentation</a>.</p> <h2 id="identity-and-access-management-deployment"> <a href="#identity-and-access-management-deployment" aria-labelledby="identity-and-access-management-deployment" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identity and Access Management Deployment </h2> <p>Deploy the Open Integration Hub Identity and Access Management (IAM). To do so, simply create a secret for IAM:</p> <ul> <li>Create a temporary file (<strong>find an example secret below</strong>) <ul> <li>Set <code class="language-plaintext highlighter-rouge">mongourl</code> to the connection string (base64 encoded) of your storage solution</li> <li>Optionally set the other values of the other keys. Standard value: ‘somestring’</li> </ul> </li> <li>Execute <code class="language-plaintext highlighter-rouge">kubectl apply -f YOUR_TEMPORARY_FILE</code></li> <li>Execute <code class="language-plaintext highlighter-rouge">kubectl apply -f services/iam/k8s</code></li> </ul> <p>Wait until the service is fully deployed and ready. Afterwards, check if iam is existent on your cluster.</p> <p>Example Secret:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">iam</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">oih-dev-ns</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">mongourl</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bW9uZ29kYjovL21vbmdvZGItc2VydmljZS5vaWgtZGV2LW5zLnN2Yy5jbHVzdGVyLmxvY2FsL2lhbQ=='</span>
  <span class="na">jwtsecret</span><span class="pi">:</span> <span class="s1">'</span><span class="s">c29tZXN0cmluZw=='</span>
  <span class="na">cookiesecret</span><span class="pi">:</span> <span class="s1">'</span><span class="s">c29tZXN0cmluZw=='</span>
  <span class="na">admin_password</span><span class="pi">:</span> <span class="s1">'</span><span class="s">c29tZXN0cmluZw=='</span>
  <span class="na">serviceacc_password</span><span class="pi">:</span> <span class="s1">'</span><span class="s">c29tZXN0cmluZw=='</span>
  <span class="na">oidc_client_secret</span><span class="pi">:</span> <span class="s1">'</span><span class="s">c29tZXN0cmluZw=='</span>
</code></pre></div></div> <h2 id="service-account-creation"> <a href="#service-account-creation" aria-labelledby="service-account-creation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service Account Creation </h2> <p>Create a service account and token for all of the services listed below.</p> <ul> <li>Attachment-Storage-Service</li> <li>Audit-Log</li> <li>Component-Orchestrator</li> <li>Component-Repository</li> <li>DataHub</li> <li>Dispatcher</li> <li>Flow-Repository</li> <li>MetaData-Repository</li> <li>Secret-Service</li> </ul> <p>Use Postman (or another similar tool of your choice), to send these POST requests the IAM.</p> <h3 id="receive-user-token"> <a href="#receive-user-token" aria-labelledby="receive-user-token" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Receive User Token </h3> <p>First, you have to request a user token (for admin account). This step only need to be perfomed once.</p> <p><strong>Base URL:</strong> <code class="language-plaintext highlighter-rouge">IAM_BASE_URL</code> (received from ingress)</p> <p><strong>Header:</strong> <code class="language-plaintext highlighter-rouge">Content-Type: application/json</code>:</p> <h3 id="login-as-admin"> <a href="#login-as-admin" aria-labelledby="login-as-admin" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Login as Admin </h3> <p><em>Path</em>:</p> <p><code class="language-plaintext highlighter-rouge">/login</code></p> <p><em>Request Body:</em></p> <p>If you haven’t changed the <code class="language-plaintext highlighter-rouge">admin_password</code> in the secret you created a few steps ago, you can use the following json. Otherwise replace the password with the new value.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin@openintegrationhub.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"somestring"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><em>Response Body Structure:</em></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Use the returned <code class="language-plaintext highlighter-rouge">token</code> as a Bearer token for the remaining requests.</p> <h3 id="create-a-service-account"> <a href="#create-a-service-account" aria-labelledby="create-a-service-account" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a Service Account </h3> <p>After you received the user token, a service account must be created for each service listed at the <a href="#service-account-creation">beginning</a> of this chapter.</p> <p>Expect for <code class="language-plaintext highlighter-rouge">component orchestrator</code>, each service needs at least the following permission:</p> <ul> <li><code class="language-plaintext highlighter-rouge">iam.token.introspect</code></li> </ul> <p>Component Orchestrator needs the following permissions:</p> <ul> <li>Component Orchestrator: <code class="language-plaintext highlighter-rouge">components.any.read</code>, <code class="language-plaintext highlighter-rouge">iam.token.create</code>, <code class="language-plaintext highlighter-rouge">iam.token.delete</code></li> </ul> <p>Replace the following values with a value of your choice:</p> <ul> <li><code class="language-plaintext highlighter-rouge">firstname</code></li> <li><code class="language-plaintext highlighter-rouge">lastname</code></li> <li><code class="language-plaintext highlighter-rouge">password</code></li> </ul> <p><em>Path:</em></p> <p><code class="language-plaintext highlighter-rouge">/api/v1/users</code></p> <p><em>Request Body:</em></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"servicename@serviceaccount.de"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"a"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"b"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="s2">"SERVICE_ACCOUNT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"ACTIVE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"asd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"permissions"</span><span class="p">:[</span><span class="w">
      </span><span class="s2">"iam.token.introspect"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"components.get"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><em>Response Body Structure:</em></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tenant"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"all"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"all"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"confirmed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>The returned <code class="language-plaintext highlighter-rouge">id</code> is later needed to create a service token.</p> <h3 id="create-persistent-service-token"> <a href="#create-persistent-service-token" aria-labelledby="create-persistent-service-token" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create persistent Service Token </h3> <p><em>Path:</em></p> <p><code class="language-plaintext highlighter-rouge">/api/v1/tokens</code></p> <p><em>Request Body:</em></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASTE SERVICE ACCOUNT ID HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"expiresIn"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>The returned token is the service token that will be used by the other services to authenticate themselves to the IAM. Copy the value, encode it in <em>base64</em> (for encoding you can use online tools such as: <a href="https://www.base64encode.org/">https://www.base64encode.org/</a>), and then paste it into the secret files for each of the services listed at the <a href="#service-account-creation">beginning</a> of this chapter.</p> <h3 id="secret-creation"> <a href="#secret-creation" aria-labelledby="secret-creation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Secret Creation </h3> <p>For each services listed in <code class="language-plaintext highlighter-rouge">./services</code> a secret file is needed. Thus, the following steps need to be performed for every service:</p> <ul> <li>Replace <code class="language-plaintext highlighter-rouge">metadata.name</code> with the current service name</li> <li><code class="language-plaintext highlighter-rouge">Data</code> must include all <code class="language-plaintext highlighter-rouge">secretKeyRef</code>s from the <code class="language-plaintext highlighter-rouge">./k8s/deployment.yaml</code> of each service. E.g. flow repository: <a href="https://github.com/openintegrationhub/openintegrationhub/blob/master/services/flow-repository/k8s/deployment.yaml#L20-L29">flow-repository deployment.yaml</a></li> <li>For each service that was listed at the <a href="#service-account-creation">beginning</a> of this chapter make sure to add the persistent token as the value for the <strong>iamtoken</strong>.</li> </ul> <p>Example secret file for <strong>flow-repository</strong>:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">flow-repository</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">oih-dev-ns</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">mongourl</span><span class="pi">:</span> <span class="s">CONNECTION_URL</span>
  <span class="na">iamtoken</span><span class="pi">:</span> <span class="s">IAM TOKEN</span>
</code></pre></div></div> <p>Once you created the secret files, execute the following commands for each service:</p> <ol> <li>Execute <code class="language-plaintext highlighter-rouge">kubectl apply -f YOUR_TEMPORARY_FILE</code></li> <li>Execute <code class="language-plaintext highlighter-rouge">kubectl apply -f services/CURRENT_SERVICE/k8s</code></li> </ol> <h2 id="service-availability"> <a href="#service-availability" aria-labelledby="service-availability" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service Availability </h2> <p>The Open Integration Hub is now running and ought to function just as it would in an online context. You can reach the various services via the following URLS:</p> <ul> <li><strong>Identity and Access Management</strong>. Create and modify users, tenants, roles, and permissions. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR IAM URL</code></li> </ul> </li> <li><strong>Secret Service</strong>. Securely store authentication data for other applications. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Secret-Service URL</code></li> </ul> </li> <li><strong>Flow Repository</strong>. Create, modify, and start/stop integration flows. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Flow-Repository URL</code></li> </ul> </li> <li><strong>Audit Log</strong>. View event logs spawned by the other services. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Audit-Log URL</code></li> </ul> </li> <li><strong>Metadata Repository</strong>. Create and modify master data models used by your connectors. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Meta-Data-Repository URL</code></li> </ul> </li> <li><strong>Component Repository</strong>. Store and modify connector components. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Component-Repository URL</code></li> </ul> </li> <li><strong>Attachment Storage Service</strong>. Temporarily store larger files for easier handling in flows. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Attachment-Storage-Service URL</code></li> </ul> </li> <li><strong>Data Hub</strong>. Long-term storage for flow content. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Data-Hub URL</code></li> </ul> </li> <li><strong>Integration Layer Service</strong>. Perform data operations such as merging or splitting objects. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Integration-Layer-Service URL</code></li> </ul> </li> <li><strong>Web UI</strong>. A basic browser-based UI to control certain other services. <ul> <li><code class="language-plaintext highlighter-rouge">YOUR Web-UI URL</code></li> </ul> <p>Most of these services have an OpenAPI documentation of their API available through the path <code class="language-plaintext highlighter-rouge">/api-docs</code>. You can also check the <a href="https://openintegrationhub.github.io/docs/API%20Reference/APIReferenceOverview.html">API Reference Documentation</a>. If you want to learn more about the services, check the <a href="https://openintegrationhub.github.io/docs/Services/Services.html">Service Documentation</a> or their readmes in the <code class="language-plaintext highlighter-rouge">services</code> folder of the GitHub Repository: <a href="https://github.com/openintegrationhub/openintegrationhub/tree/master/services">Open Integration Hub Services</a></p> <h1 id="user-tutorial"> <a href="#user-tutorial" aria-labelledby="user-tutorial" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User Tutorial </h1> <p>The following step-by-step guide will show you how you can add your first components and create a flow with these components via the web ui which you deployed already. All actions are also performable via postman or similar tools.</p> <h2 id="creating-components"> <a href="#creating-components" aria-labelledby="creating-components" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Components </h2> <p>First, we have to create two components in order to have a source and target component.</p> <p>Below you will find code snippets for two exemplary components. For the beginning we recommend to use those but feel free to use your own.</p> <p><strong>Example 1:</strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"distribution"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"docker"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"image"</span><span class="p">:</span><span class="s2">"elasticio/timer:ca9a6fea391ffa8f7c8593bd2a04143212ab63f6"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"access"</span><span class="p">:</span><span class="s2">"public"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Timer"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="s2">"Timer component that periodically triggers flows on a given interval"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> <p><strong>Example 2:</strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"distribution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elasticio/code-component:7bc2535df2f8a35c3653455e5becc701b010d681"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"access"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Node.js code"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Node.js code component that executes the provided code"</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> <p>The timer component is used to trigger flows on a provided interval, while the code component executes the code that was provided by the flow creator.</p> <p>In order to add those components, visit the web ui (<code class="language-plaintext highlighter-rouge">web-ui.localoih.com</code>) and navigate to the <code class="language-plaintext highlighter-rouge">Components</code> section.</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/menu.png" alt="Sublime's custom image" width="150" /> </p> <p>Now click on the <code class="language-plaintext highlighter-rouge">ADD+</code> button. A popup window will appear where you can add the code provided above.</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/AddComponent.png" alt="Sublime's custom image" width="1200" /> </p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/popUpWindowComponent.PNG" alt="Sublime's custom image" width="300" /> </p> <p><strong>GREAT!</strong> You created your first component.</p> <p>Repeat this step for the second component.</p> <p><strong>!!</strong> In order to create the flow in the next step you have to copy the <code class="language-plaintext highlighter-rouge">ids</code> of the components you just created. <strong>!!</strong></p> <h2 id="creating-flows"> <a href="#creating-flows" aria-labelledby="creating-flows" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Flows </h2> <p>Now that you successfully created two components it is time to create your first flow.</p> <p>Below you will find code snippets for an example flow. This excample flow periodically triggers the flow and sends request to webhook.site. For the beginning we recommend to use this flow but feel free to create your own.</p> <p>Please replace the <code class="language-plaintext highlighter-rouge">ADD COMPONENT ID HERE</code> with the <code class="language-plaintext highlighter-rouge">ids</code> you copied in the previous step. Furthermore please go to <a href="http://webhook.site/"></a> and copy the link to you clipboard. Afterwards please replace the <code class="language-plaintext highlighter-rouge">ADD WEBHOOK URL HERE</code> with the link in your clipboard.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Timer To Code Component Example"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"description:"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This flow periodically triggers the flow and sends request to webhook.site"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"graph"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"nodes"</span><span class="p">:[</span><span class="w">
         </span><span class="p">{</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"step_1"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"componentId"</span><span class="p">:</span><span class="s2">"ADD COMPONENT ID HERE"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"function"</span><span class="p">:</span><span class="s2">"timer"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="p">{</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"step_2"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"componentId"</span><span class="p">:</span><span class="s2">"ADD COMPONENT ID HERE"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"function"</span><span class="p">:</span><span class="s2">"execute"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"fields"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"code"</span><span class="p">:</span><span class="s2">"function* run() {console.log('Calling external URL');yield request.post({uri: 'ADD WEBHOOK URL HERE', body: msg, json: true});}"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"edges"</span><span class="p">:[</span><span class="w">
         </span><span class="p">{</span><span class="w">
            </span><span class="nl">"source"</span><span class="p">:</span><span class="s2">"step_1"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"target"</span><span class="p">:</span><span class="s2">"step_2"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"cron"</span><span class="p">:</span><span class="s2">"*/2 * * * *"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> <p>In order to add the flow, navigate to the <code class="language-plaintext highlighter-rouge">Flows</code> section.</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images//menuFlow.png" alt="Sublime's custom image" width="150" /> </p> <p>Now click on the <code class="language-plaintext highlighter-rouge">ADD+</code> button. A popup window will appear where you can add the code provided above.</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/AddFlow.png" alt="Sublime's custom image" width="1200" /> </p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/popUpWindowFlow.PNG" alt="Sublime's custom image" width="300" /> </p> <p><strong>GREAT!</strong> You created your first flow.</p> <h2 id="starting-flows"> <a href="#starting-flows" aria-labelledby="starting-flows" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting Flows </h2> <p>Now that you have created two components and a flow, it is time to start this flow.</p> <p>Stay in the flows section and look for the flow you just created. On the right side you will the a “play” symbol.</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/play.png" alt="Sublime's custom image" width="300" /> </p> <p>Click on it and the how the status changes from <code class="language-plaintext highlighter-rouge">inactive</code> to <code class="language-plaintext highlighter-rouge">starting</code>.</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/inactive.PNG" alt="Sublime's custom image" width="500" /> </p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/starting.PNG" alt="Sublime's custom image" width="500" /> </p> <p>After some time the status changes to <code class="language-plaintext highlighter-rouge">active</code> and the flow is running (you may have to refresh the site).</p> <p align="left"> <img src="https://raw.githubusercontent.com/openintegrationhub/openintegrationhub.github.io/master/assets/images/active.PNG" alt="Sublime's custom image" width="500" /> </p> <h2 id="lessons-learned"> <a href="#lessons-learned" aria-labelledby="lessons-learned" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lessons Learned </h2> <p>In this tutorial you have learned…</p> <ol> <li>How to create components via the web ui</li> <li>How to create a flow within the Open Integration Hub using existing components</li> <li>How to start a flow and track its status</li> </ol> </li> </ul> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020 <a href="https://cloudecosystem.org">Cloud Ecosystem e.V.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
